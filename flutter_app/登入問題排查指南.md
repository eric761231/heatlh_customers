# 🔍 登入問題排查指南

## ❓ 常見登入失敗原因

### 1. 網路連線問題 ⚠️ 最常見

**症狀：**
- 登入按鈕點擊後沒有反應
- 顯示「登入失敗，請重試」
- 載入圖示一直轉動

**檢查方法：**
1. 確認手機已連接網路（WiFi 或行動網路）
2. 嘗試打開瀏覽器訪問其他網站
3. 檢查手機是否允許此應用程式使用網路

**解決方法：**
- 檢查手機網路設定
- 確認 Supabase 服務是否正常（訪問 https://lvrcnmvnqbueghjyvxji.supabase.co）

### 2. Email 未驗證

**症狀：**
- 顯示「請先確認您的 Email」
- 註冊後無法登入

**解決方法：**
1. 檢查註冊時使用的 Email 收件匣
2. 查看垃圾郵件資料夾
3. 點擊 Supabase 發送的驗證連結
4. 驗證完成後再嘗試登入

### 3. Email 或密碼錯誤

**症狀：**
- 顯示「Email 或密碼錯誤」

**解決方法：**
1. 確認 Email 地址正確（大小寫不敏感）
2. 確認密碼正確（大小寫敏感）
3. 如果忘記密碼，使用「忘記密碼」功能重置

### 4. Supabase 配置問題

**症狀：**
- 所有登入都失敗
- 沒有任何錯誤訊息

**檢查項目：**
1. Supabase URL 是否正確
2. Supabase Key 是否正確
3. Supabase 專案是否正常運行

### 5. Android 網路權限問題

**症狀：**
- 應用程式無法連接網路

**檢查方法：**
1. 確認 `AndroidManifest.xml` 中有網路權限
2. 檢查手機設定中是否允許應用程式使用網路

## 🔧 排查步驟

### 步驟 1：檢查網路連線

```bash
# 在手機上打開瀏覽器
# 訪問：https://lvrcnmvnqbueghjyvxji.supabase.co
# 如果無法訪問，可能是網路問題
```

### 步驟 2：檢查錯誤訊息

登入失敗時，應用程式會顯示錯誤訊息：
- **「Email 或密碼錯誤」** → 檢查帳號密碼
- **「請先確認您的 Email」** → 驗證 Email
- **「登入失敗，請重試」** → 可能是網路問題

### 步驟 3：檢查 Supabase 設定

1. 登入 Supabase Dashboard
2. 檢查 Authentication → Settings
3. 確認 Email 驗證設定
4. 檢查是否有 IP 限制或速率限制

### 步驟 4：測試登入

1. **使用網頁版本測試**
   - 訪問網頁版本
   - 嘗試登入相同帳號
   - 如果網頁可以登入，問題可能在手機 APP

2. **檢查手機設定**
   - 設定 → 應用程式 → heath_app
   - 確認「網路存取」權限已開啟

## 🛠️ 解決方法

### 方法 1：重新安裝應用程式

```bash
# 1. 卸載舊版本
# 2. 重新安裝 APK
# 3. 重新嘗試登入
```

### 方法 2：檢查網路權限

確認 `AndroidManifest.xml` 包含：
```xml
<uses-permission android:name="android.permission.INTERNET"/>
```

### 方法 3：清除應用程式資料

1. 設定 → 應用程式 → heath_app
2. 儲存空間 → 清除資料
3. 重新開啟應用程式

### 方法 4：檢查 Supabase 設定

1. 登入 Supabase Dashboard
2. Authentication → Settings
3. 確認：
   - Email 驗證是否啟用
   - 是否需要 Email 驗證才能登入
   - 是否有其他限制

## 📱 手機上測試

### 測試步驟

1. **確認網路連線**
   - 打開瀏覽器，訪問任意網站
   - 確認可以正常上網

2. **嘗試登入**
   - 輸入 Email 和密碼
   - 點擊登入按鈕
   - 觀察錯誤訊息

3. **檢查錯誤訊息**
   - 如果顯示具體錯誤，按照錯誤訊息處理
   - 如果沒有錯誤訊息，可能是網路問題

### 常見錯誤訊息對照

| 錯誤訊息 | 原因 | 解決方法 |
|---------|------|---------|
| Email 或密碼錯誤 | 帳號或密碼不正確 | 檢查輸入，或使用忘記密碼 |
| 請先確認您的 Email | Email 未驗證 | 檢查收件匣並點擊驗證連結 |
| 登入失敗，請重試 | 網路問題或伺服器錯誤 | 檢查網路，稍後再試 |
| 此 Email 尚未註冊 | 帳號不存在 | 先註冊帳號 |

## 🔐 Supabase 設定檢查

### 1. Email 驗證設定

在 Supabase Dashboard：
- Authentication → Settings → Email Auth
- 確認「Enable email confirmations」設定
- 如果啟用，註冊後需要驗證 Email 才能登入

### 2. 速率限制

檢查是否有速率限制：
- Authentication → Settings → Rate Limits
- 如果登入嘗試過於頻繁，可能被暫時限制

### 3. RLS 政策

確認資料庫 RLS 政策正確：
- 檢查 `users` 表的 RLS 政策
- 確認登入後可以查詢自己的資料

## 💡 除錯建議

### 1. 啟用詳細日誌

在開發模式下，查看終端輸出：
```bash
flutter run
# 觀察登入時的錯誤訊息
```

### 2. 使用網頁版本對比

如果網頁版本可以登入，但手機 APP 不行：
- 可能是手機網路問題
- 可能是 APP 配置問題

### 3. 檢查 Supabase 日誌

在 Supabase Dashboard：
- Logs → Auth Logs
- 查看登入嘗試的記錄
- 確認是否有錯誤訊息

## 🆘 如果還是不行

請提供以下資訊：

1. **錯誤訊息**
   - 手機上顯示的完整錯誤訊息

2. **網路狀態**
   - 手機是否可以上網
   - 是否可以訪問 Supabase

3. **測試結果**
   - 網頁版本是否可以登入
   - 是否使用相同帳號測試

4. **手機資訊**
   - Android 版本
   - 手機型號

---

**快速檢查清單：**
- [ ] 手機已連接網路
- [ ] Email 已驗證（如果 Supabase 要求）
- [ ] Email 和密碼正確
- [ ] 網頁版本可以登入（對比測試）
- [ ] 應用程式有網路權限
- [ ] Supabase 服務正常運行

